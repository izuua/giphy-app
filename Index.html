<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giphy App</title>
    <!-- Added link to the jQuery Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Reset CSS -->
    <link rel="stylesheet" type="text/css" href="./assets/css/reset.css">
    <!-- Added a link to Bootstrap-->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"> -->
    <link rel="stylesheet" type="text/css" href="./assets/css/bootstrap.min.css">

    <style type="text/css">
        button,
        div,
        form,
        input {
          margin: 10px;
        }

        .giphy {
            margin: 10px;
        }

      </style>
</head>

<body>

    <div class="container">
        <h1>Giphy Search</h1>

        <div id="buttons-view"></div>

        <form id="giphy-form">
            <label for="giphy-input">Add a New Search Topic</label>
            <input type="text" id="giphy-input">

            <br>

            <input id="add-giphy" type="submit" value="Add a New Search Topic">
        </form>


        <div id="giphy-view">
        </div>
    </div>

<script>

    var apiKey = "rRXbzSTaRhDPan5iHyzLEm1l33aqF5Jr"
    var giphyTopics = ["Twilight Sparkle", "Rarity", "Pinkie Pie", "Applejack", "Rainbow Dash", "Fluttershy"]

    function renderButtons(str) { //function to render the buttons
        $("#buttons-view").empty();

        giphyTopics.forEach(function(str) { //goes through the array and creates a button for each giphy topic
            var button = $("<button>");
            button.addClass("giphy-button");
            button.attr("data-name", str);
            button.text(str);
            $(button).appendTo("#buttons-view");
            // $("<button class=giphy-button data-name="+str+">"+"BUTTON").appendTo("#buttons-view"); //This seems to be working incorrectly
        })

    }

    function giphyAnimate() { //function to animate or stop the gif when clicked
        console.log("giphy click working");
        if ($(this).attr("data-state") === "still") {
            $(this).attr("data-state", "animate");
            $(this).attr("src", $(this).attr("data-animate"));
        } else {
            $(this).attr("data-state", "still");
            $(this).attr("src", $(this).attr("data-still"));
        }
    }


    function displayGiphys() { //function to display gifs
        $("#giphy-view").empty();

        var giphyTopic = $(this).attr("data-name");
        
        $("<h3>Click to animate</h3>").appendTo("#giphy-view");

        $.ajax({
            url: "https://api.giphy.com/v1/gifs/search?api_key=rRXbzSTaRhDPan5iHyzLEm1l33aqF5Jr&q=" + giphyTopic + "&limit=10&offset=0&rating=PG-13&lang=en",
            method: "GET"
        }).then(function(response) {
            var results = response.data;
            
            for (i =0; i < results.length; i++) {
                $("<div>Rating: "+results[i].rating+"</div>").appendTo("#giphy-view");

                $("<img src="+results[i].images.fixed_width_still.url+" class=giphy data-still="+results[i].images.fixed_width_still.url+" data-animate="+results[i].images.fixed_width.url+" data-state=still>").appendTo("#giphy-view");
            }
        })
    }

    //results[i].images.fixed_width.url for animated
    //results[i].images.fixed_width_still.url

    $("#add-giphy").on("click", function(event) { //adds a new topic
        event.preventDefault();

        console.log($("#giphy-input").val().trim());
        giphyTopics.push($("#giphy-input").val().trim());

        $("#add-giphy").text(""); //resets the search text after you hit it
        renderButtons();
    })



    $(document).on("click", ".giphy-button", displayGiphys);

    $(document).on("click", ".giphy", giphyAnimate);

    renderButtons();

</script>
</body>

</html>